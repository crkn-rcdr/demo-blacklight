import{createElement as t,PureComponent as e}from"react";import i from"react-draggable";import{Resizable as o}from"re-resizable";var extendStatics=function(t,e){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return extendStatics(t,e)};function __extends(t,e){extendStatics(t,e);function __(){this.constructor=t}t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}var __assign=function(){__assign=Object.assign||function __assign(t){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t};return __assign.apply(this,arguments)};function __rest(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(t);s<o.length;s++)e.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(t,o[s])&&(i[o[s]]=t[o[s]])}return i}var s=i;var r={width:"auto",height:"auto",display:"inline-block",position:"absolute",top:0,left:0};var getEnableResizingByFlag=function(t){return{bottom:t,bottomLeft:t,bottomRight:t,left:t,right:t,top:t,topLeft:t,topRight:t}};var n=function(e){__extends(Rnd,e);function Rnd(t){var i=e.call(this,t)||this;i.resizingPosition={x:0,y:0};i.offsetFromParent={left:0,top:0};i.resizableElement={current:null};i.originalPosition={x:0,y:0};i.refDraggable=function(t){t&&(i.draggable=t)};i.refResizable=function(t){if(t){i.resizable=t;i.resizableElement.current=t.resizable}};i.state={resizing:false,bounds:{top:0,right:0,bottom:0,left:0},maxWidth:t.maxWidth,maxHeight:t.maxHeight};i.onResizeStart=i.onResizeStart.bind(i);i.onResize=i.onResize.bind(i);i.onResizeStop=i.onResizeStop.bind(i);i.onDragStart=i.onDragStart.bind(i);i.onDrag=i.onDrag.bind(i);i.onDragStop=i.onDragStop.bind(i);i.getMaxSizesFromProps=i.getMaxSizesFromProps.bind(i);return i}Rnd.prototype.componentDidMount=function(){this.updateOffsetFromParent();var t=this.offsetFromParent,e=t.left,i=t.top;var o=this.getDraggablePosition(),s=o.x,r=o.y;this.draggable.setState({x:s-e,y:r-i});this.forceUpdate()};Rnd.prototype.getDraggablePosition=function(){var t=this.draggable.state,e=t.x,i=t.y;return{x:e,y:i}};Rnd.prototype.getParent=function(){return this.resizable&&this.resizable.parentNode};Rnd.prototype.getParentSize=function(){return this.resizable.getParentSize()};Rnd.prototype.getMaxSizesFromProps=function(){var t="undefined"===typeof this.props.maxWidth?Number.MAX_SAFE_INTEGER:this.props.maxWidth;var e="undefined"===typeof this.props.maxHeight?Number.MAX_SAFE_INTEGER:this.props.maxHeight;return{maxWidth:t,maxHeight:e}};Rnd.prototype.getSelfElement=function(){return this.resizable&&this.resizable.resizable};Rnd.prototype.getOffsetHeight=function(t){var e=this.props.scale;switch(this.props.bounds){case"window":return window.innerHeight/e;case"body":return document.body.offsetHeight/e;default:return t.offsetHeight}};Rnd.prototype.getOffsetWidth=function(t){var e=this.props.scale;switch(this.props.bounds){case"window":return window.innerWidth/e;case"body":return document.body.offsetWidth/e;default:return t.offsetWidth}};Rnd.prototype.onDragStart=function(t,e){this.props.onDragStart&&this.props.onDragStart(t,e);var i=this.getDraggablePosition();this.originalPosition=i;if(this.props.bounds){var o=this.getParent();var s=this.props.scale;var r;if("parent"===this.props.bounds)r=o;else{if("body"===this.props.bounds){var n=o.getBoundingClientRect();var a=n.left;var p=n.top;var h=document.body.getBoundingClientRect();var l=-(a-o.offsetLeft*s-h.left)/s;var d=-(p-o.offsetTop*s-h.top)/s;var g=(document.body.offsetWidth-this.resizable.size.width*s)/s+l;var f=(document.body.offsetHeight-this.resizable.size.height*s)/s+d;return this.setState({bounds:{top:d,right:g,bottom:f,left:l}})}if("window"===this.props.bounds){if(!this.resizable)return;var u=o.getBoundingClientRect();var c=u.left;var b=u.top;var m=-(c-o.offsetLeft*s)/s;var v=-(b-o.offsetTop*s)/s;g=(window.innerWidth-this.resizable.size.width*s)/s+m;f=(window.innerHeight-this.resizable.size.height*s)/s+v;return this.setState({bounds:{top:v,right:g,bottom:f,left:m}})}"string"===typeof this.props.bounds?r=document.querySelector(this.props.bounds):this.props.bounds instanceof HTMLElement&&(r=this.props.bounds)}if(r instanceof HTMLElement&&o instanceof HTMLElement){var z=r.getBoundingClientRect();var y=z.left;var x=z.top;var S=o.getBoundingClientRect();var R=S.left;var P=S.top;var H=(y-R)/s;var w=x-P;if(this.resizable){this.updateOffsetFromParent();var D=this.offsetFromParent;this.setState({bounds:{top:w-D.top,right:H+(r.offsetWidth-this.resizable.size.width)-D.left/s,bottom:w+(r.offsetHeight-this.resizable.size.height)-D.top,left:H-D.left/s}})}}}};Rnd.prototype.onDrag=function(t,e){if(this.props.onDrag){var i=this.offsetFromParent,o=i.left,s=i.top;return this.props.dragAxis&&"both"!==this.props.dragAxis?"x"===this.props.dragAxis?this.props.onDrag(t,__assign(__assign({},e),{x:e.x+o,y:this.originalPosition.y+s,deltaY:0})):"y"===this.props.dragAxis?this.props.onDrag(t,__assign(__assign({},e),{x:this.originalPosition.x+o,y:e.y+s,deltaX:0})):void 0:this.props.onDrag(t,__assign(__assign({},e),{x:e.x-o,y:e.y-s}))}};Rnd.prototype.onDragStop=function(t,e){if(this.props.onDragStop){var i=this.offsetFromParent,o=i.left,s=i.top;return this.props.dragAxis&&"both"!==this.props.dragAxis?"x"===this.props.dragAxis?this.props.onDragStop(t,__assign(__assign({},e),{x:e.x+o,y:this.originalPosition.y+s,deltaY:0})):"y"===this.props.dragAxis?this.props.onDragStop(t,__assign(__assign({},e),{x:this.originalPosition.x+o,y:e.y+s,deltaX:0})):void 0:this.props.onDragStop(t,__assign(__assign({},e),{x:e.x+o,y:e.y+s}))}};Rnd.prototype.onResizeStart=function(t,e,i){t.stopPropagation();this.setState({resizing:true});var o=this.props.scale;var s=this.offsetFromParent;var r=this.getDraggablePosition();this.resizingPosition={x:r.x+s.left,y:r.y+s.top};this.originalPosition=r;if(this.props.bounds){var n=this.getParent();var a=void 0;"parent"===this.props.bounds?a=n:"body"===this.props.bounds?a=document.body:"window"===this.props.bounds?a=window:"string"===typeof this.props.bounds?a=document.querySelector(this.props.bounds):this.props.bounds instanceof HTMLElement&&(a=this.props.bounds);var p=this.getSelfElement();if(p instanceof Element&&(a instanceof HTMLElement||a===window)&&n instanceof HTMLElement){var h=this.getMaxSizesFromProps(),l=h.maxWidth,d=h.maxHeight;var g=this.getParentSize();if(l&&"string"===typeof l)if(l.endsWith("%")){var f=Number(l.replace("%",""))/100;l=g.width*f}else l.endsWith("px")&&(l=Number(l.replace("px","")));if(d&&"string"===typeof d)if(d.endsWith("%")){f=Number(d.replace("%",""))/100;d=g.width*f}else d.endsWith("px")&&(d=Number(d.replace("px","")));var u=p.getBoundingClientRect();var c=u.left;var b=u.top;var m="window"===this.props.bounds?{left:0,top:0}:a.getBoundingClientRect();var v=m.left;var z=m.top;var y=this.getOffsetWidth(a);var x=this.getOffsetHeight(a);var S=e.toLowerCase().endsWith("left");var R=e.toLowerCase().endsWith("right");var P=e.startsWith("top");var H=e.startsWith("bottom");if((S||P)&&this.resizable){var w=(c-v)/o+this.resizable.size.width;this.setState({maxWidth:w>Number(l)?l:w})}if(R||this.props.lockAspectRatio&&!S&&!P){w=y+(v-c)/o;this.setState({maxWidth:w>Number(l)?l:w})}if((P||S)&&this.resizable){w=(b-z)/o+this.resizable.size.height;this.setState({maxHeight:w>Number(d)?d:w})}if(H||this.props.lockAspectRatio&&!P&&!S){w=x+(z-b)/o;this.setState({maxHeight:w>Number(d)?d:w})}}}else this.setState({maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight});this.props.onResizeStart&&this.props.onResizeStart(t,e,i)};Rnd.prototype.onResize=function(t,e,i,o){var s={x:this.originalPosition.x,y:this.originalPosition.y};var r=-o.width;var n=-o.height;var a=["top","left","topLeft","bottomLeft","topRight"];if(-1!==a.indexOf(e))if("bottomLeft"===e)s.x+=r;else if("topRight"===e)s.y+=n;else{s.x+=r;s.y+=n}s.x===this.draggable.state.x&&s.y===this.draggable.state.y||this.draggable.setState(s);this.updateOffsetFromParent();var p=this.offsetFromParent;var h=this.getDraggablePosition().x+p.left;var l=this.getDraggablePosition().y+p.top;this.resizingPosition={x:h,y:l};this.props.onResize&&this.props.onResize(t,e,i,o,{x:h,y:l})};Rnd.prototype.onResizeStop=function(t,e,i,o){this.setState({resizing:false});var s=this.getMaxSizesFromProps(),r=s.maxWidth,n=s.maxHeight;this.setState({maxWidth:r,maxHeight:n});this.props.onResizeStop&&this.props.onResizeStop(t,e,i,o,this.resizingPosition)};Rnd.prototype.updateSize=function(t){this.resizable&&this.resizable.updateSize({width:t.width,height:t.height})};Rnd.prototype.updatePosition=function(t){this.draggable.setState(t)};Rnd.prototype.updateOffsetFromParent=function(){var t=this.props.scale;var e=this.getParent();var i=this.getSelfElement();if(!e||null===i)return{top:0,left:0};var o=e.getBoundingClientRect();var s=o.left;var r=o.top;var n=i.getBoundingClientRect();var a=this.getDraggablePosition();var p=e.scrollLeft;var h=e.scrollTop;this.offsetFromParent={left:n.left-s+p-a.x*t,top:n.top-r+h-a.y*t}};Rnd.prototype.render=function(){var e=this.props,i=e.disableDragging,n=e.style,a=e.dragHandleClassName,p=e.position,h=e.onMouseDown,l=e.onMouseUp,d=e.dragAxis,g=e.dragGrid,f=e.bounds,u=e.enableUserSelectHack,c=e.cancel,b=e.children,m=(e.onResizeStart,e.onResize,e.onResizeStop,e.onDragStart,e.onDrag,e.onDragStop,e.resizeHandleStyles),v=e.resizeHandleClasses,z=e.resizeHandleComponent,y=e.enableResizing,x=e.resizeGrid,S=e.resizeHandleWrapperClass,R=e.resizeHandleWrapperStyle,P=e.scale,H=e.allowAnyClick,w=__rest(e,["disableDragging","style","dragHandleClassName","position","onMouseDown","onMouseUp","dragAxis","dragGrid","bounds","enableUserSelectHack","cancel","children","onResizeStart","onResize","onResizeStop","onDragStart","onDrag","onDragStop","resizeHandleStyles","resizeHandleClasses","resizeHandleComponent","enableResizing","resizeGrid","resizeHandleWrapperClass","resizeHandleWrapperStyle","scale","allowAnyClick"]);var D=this.props.default?__assign({},this.props.default):void 0;delete w.default;var W=i||a?{cursor:"auto"}:{cursor:"move"};var _=__assign(__assign(__assign({},r),W),n);var A=this.offsetFromParent,E=A.left,C=A.top;var O;p&&(O={x:p.x-E,y:p.y-C});var F=this.state.resizing?void 0:O;var M=this.state.resizing?"both":d;return t(s,{ref:this.refDraggable,handle:a?".".concat(a):void 0,defaultPosition:D,onMouseDown:h,onMouseUp:l,onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop,axis:M,disabled:i,grid:g,bounds:f?this.state.bounds:void 0,position:F,enableUserSelectHack:u,cancel:c,scale:P,allowAnyClick:H,nodeRef:this.resizableElement},t(o,__assign({},w,{ref:this.refResizable,defaultSize:D,size:this.props.size,enable:"boolean"===typeof y?getEnableResizingByFlag(y):y,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,style:_,minWidth:this.props.minWidth,minHeight:this.props.minHeight,maxWidth:this.state.resizing?this.state.maxWidth:this.props.maxWidth,maxHeight:this.state.resizing?this.state.maxHeight:this.props.maxHeight,grid:x,handleWrapperClass:S,handleWrapperStyle:R,lockAspectRatio:this.props.lockAspectRatio,lockAspectRatioExtraWidth:this.props.lockAspectRatioExtraWidth,lockAspectRatioExtraHeight:this.props.lockAspectRatioExtraHeight,handleStyles:m,handleClasses:v,handleComponent:z,scale:this.props.scale}),b))};Rnd.defaultProps={maxWidth:Number.MAX_SAFE_INTEGER,maxHeight:Number.MAX_SAFE_INTEGER,scale:1,onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},onDragStart:function(){},onDrag:function(){},onDragStop:function(){}};return Rnd}(e);export{n as Rnd};

